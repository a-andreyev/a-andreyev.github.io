# Matrix IM @ 2600 на русском

Выступил с докладом "Matrix. Система мгновенного обмена сообщениями: теория и практика" на ежемесячных встречах [2600 в Санкт-Петербурге](http://2600.spb.ru/) 1 ноября 2019 года.

Disclaimer. Выбить время на подготовку давалось тяжело, и всё откладывалось. Поэтому решил выступить, даже если буду сам плавать в теме. Привожу текстовый пересказ выступления. Жирным курсивом выделены комментарии из зала. В текст внесены исправления и уточнения. Не дословная, и не такая ламповая версия, как само мероприятие. Отдельная благодарность [kitsune](https://matrix.to/#/@kitsune:matrix.org) за дополнительные комментарии к публикации и помощь.

![2600 spb event](https://i.imgur.com/MCqKoCo.jpg)

![Matrix. Система мгновенного обмена сообщениями: Теория и практика.](https://i.imgur.com/HM4rClo.png)

— ***Алексей сегодня расскажет нам про messenger и протокол Matrix***


— Расскажу вводные слова о том, что это такое. И постараюсь, может быть, чуть-чуть рассказать о том, как принимал участие.


Начнем со вступления. Я взял за вдохновение предыдущий доклад со слайдами, основанными на фильме. Кто-нибудь узнает, из какого фильма кадр?

![](https://i.imgur.com/hM9Ge5F.jpg)


***— Хакеры? :D***

— Нет, нет. Конец восьмидесятых. Режиссер Карпентер. Короче, фильм называется ["They Live" ("Чужие среди нас")](https://www.themoviedb.org/movie/8337-they-live). Старый фильм о том, как один мужик с телосложением профессионального рестлера получает очки, в которых осознает, что не все люди ведут себя хорошо, а [беспорядочное потребление и карьеризм — это плохо](https://twitter.com/thehorrormaster/status/816486706186596352). Спасибо Карпентеру за клевый фильм.

***— Obey, consume!***

— Да, да! Слоган такой: "пока вы спите, они живут". И вот, я буду пытаться "петросянить" по этому поводу. Про то, что мы сейчас пользуемся клиентами, но про сервера обычно не заботимся...

## Введение


Есть определенный [протокол](https://matrix.org/docs/spec/) и его [реализация](https://github.com/matrix-org), называется [Matrix](https://matrix.org/). Развивается сообществом Matrix. Почему Matrix? Не потому, что кино, а потому, что "matrixed" с английского — связанное воедино. То есть сеть потенциально должна [связать воедино](https://twitter.com/matrixdotorg/status/841424770025545730) те разрозненные коммуникации, которые мы сейчас имеем.

[Позиционирует](https://www.reddit.com/r/privacy/comments/da219t/im_project_lead_for_matrixorg_the_open_protocol) себя этот стандарт как открытый слой для IP-коммуникаций со сквозным шифрованием для обмена любыми данными. То есть это не прикладной протокол, это не замена интернета или какого-нибудь IP-стека. Если я не путаю, то он на уровне чуть ниже прикладного и чуть выше...

***— Физического :D***

— Который должен помочь нам сделать наши коммуникации лучше.

## Цели и задачи проекта

Первая цель проекта: решить проблему фрагментации IP-коммуникаций. [Сейчас](https://youtu.be/KbWfzyQBWrU) мессенджеры, призывающие решить задачу [массовых мгновенных коммуникаций](https://www.youtube.com/watch?v=xzX1mYVtZJg), — все, в основном, централизованы, закованы на себе. Из-за этого само общение фрагментировано: мы не можем человеку, который пользуется скайпом, написать из телеги "давай встретимся". Это первая проблема.

***— Jabber-транспорт?***

— Да, сейчас про Jabber [тоже будет](https://youtu.be/AlndCl30OyI?t=211) :)

Вторая задача: сделать это решение массовым. Нужно, чтобы решение не было маргинальным, чтобы оно стало чем-то вроде замены whatsapp, skype, slack и подобных решений.


***— Еще один стандарт... :D***

— Надеюсь, позже будет понятно, что это не просто "еще один стандарт", как мы все шутим с [xkcd](https://xkcd.ru/927/).

Третья, следующая задача: дать возможность пользователю контролировать свои данные и посредников, которые участвуют в этом обмене.

Финальная задача: от децентрализованного распределенного месседжера перейти к решению peer-to-peer. Сделать общение таким же простым, как в обычной жизни, когда мы общаемся только с тем, с кем захотим...

***— Без посредников***

— Все как мы любим, да.

***[kitsune] Финальная задача не совсем такая — точнее, это лишь одна из задач.***

***[kitsune] Финальная задача: сделать мгновенные сообщения такой же не обременённой корпоративными интересами средой, какой сейчас является электронная почта. Хотя... даже эта формулировка частична :( Наверное, мне проще всего сослаться на [FAQ](https://matrix.org/faq-ru/):***

***"Долгосрочная цель Matrix состоит в том, чтобы стать основной системой для отправки сообщений и синхронизации данных по всей сети, позволяя людям, сервисам и устройствам легко общаться друг с другом, давая пользователям контроль над своими данными и выбор между сервисами и вендорами, которые они захотят использовать. "***

## Актуальность

Актуальность, я думаю, всем понятна. Массовые решения по-прежнему централизованы, фрагментированы и закрыты. У нас нет сейчас для мгновенного обмена сообщениями или каких-нибудь более сложных решений, вроде видео-конференций — такого же стандарта, как, например, e-mail. Когда мы не привязаны к конкретному серверу, но можем написать на другой.

## Предмет и объект проекта

Подчеркну также, чем решение является и чем нет. Это стандарт поверх IP-коммуникаций, при этом он не является очередным прикладным протоколом, который пытается заменить собой решения любого уровня.

## Рабочая гипотеза

Что авторы пытаются проверить на практике: что вообще можно сделать IM-решение более безопасным (менее централизованным), но при этом доступным массово. Классическая проблема: найти баланс между безопасностью и удобством.

## Методология и методы

Что предлагается делать. Для текущей итерации вводятся понятия клиента, сервера, клиентских сервисов и центров идентификации. Ключевой момент: [клиент](https://matrix.org/docs/spec/client_server/latest) и [сервер](https://matrix.org/docs/spec/server_server/latest). С [центрами идентификации](https://matrix.org/docs/spec/identity_service/latest) сложнее, с ними нужно разбираться отдельно. Cерверы могут общаться и обмениваться перепиской между собой, а клиенты могут при этом находиться на любом из этих серверов.

![](https://i.imgur.com/thewsJa.png)


Стоит также, наверное, провести аналогию между git и этим протоколом. Когда мы храним какой-то код с git, даже если мы удалили одну репу, но не удалили ее клоны, то код не теряется. Точно также и здесь: если один из серверов уничтожается или недоступен, переписка при этом хранится на всех из них, и доступ остается.

***— А как быть с приватностью в этом случае?***

— Вот, это проблема. Ее и пытаются [решать](https://youtu.be/-ofZMnKkp_Y). Как минимум, вводится сквозное шифрование. Для того, чтобы подобное внедрять и пробовать на практике, пришлось довольно много времени потратить (несколько лет) на разработку и заказ аудита библиотеки шифрования. Она называется [olm](https://gitlab.matrix.org/matrix-org/olm/).

![](https://i.imgur.com/aco38CL.png)


[Olm](https://ru.wikipedia.org/wiki/%D0%95%D0%B2%D1%80%D0%BE%D0%BF%D0%B5%D0%B9%D1%81%D0%BA%D0%B8%D0%B9_%D0%BF%D1%80%D0%BE%D1%82%D0%B5%D0%B9) — это такой земноводный "гад", который обитает где-то в Европе.

***— Ящерка? На axolotl похож...***

— Да! Почему похож: потому что брался прицип Double Ratchet, как у Signal (Whisper Systems) — другого решения, которое сейчас стандарт де-факто для защищенных сообщений. Писалась альтернативная реализация, которую назвали olm. Но при этом используется она лишь как часть для инициализации более сложной схемы, которую назвали megolm, для сообщений групп: не только один на один, а для групп. И вообще, сейчас в реализации "группы" — первичное понятие, а общение "один-на-один" — всего лишь частный случай группы. Про это еще позже уточню.

Страшные слова: про AES, про SHA, про Curve, про Double Ratchet и про Ratchet, — про них, скорее всего, нужно делать отдельную историю. Не смогу рассказать прямо сейчас.

Интересный момент про [взаимодействие Matrix с Whisper Systems](https://news.ycombinator.com/item?id=11725827). Не помню, были ли где-то еще детали, но потенциально закладывалась возможность совместимости, если бы Мокси и OWS согласились.

Так или иначе, в Matrix сделали свою реализацию. Провели аудит, потратили кучу времени.

***— И денег***

— Да, и денег.

***— Аудит такой же, как у любого другого шифрования?***

— [Да](https://matrix.org/blog/2016/11/21/matrixs-olm-end-to-end-encryption-security-assessment-released-and-implemented-cross-platform-on-riot-at-last). В Matrix не стали пока заниматься стандартизацией через организации вроде IETF или IEEE, потому что это займет еще больше времени. Но аудит заказывали.

Интересный момент: в этом протоколе подразумевается возможность публичные группы не шифровать "в сквозную". Это удобно для групп, где тысячи тысяч человек, и важнее публично хранить историю переписки, а не следить за шифрованием.

***— А в чем прикол вообще опционального отключения шифрования?***

— Очень сложно сделать удобное общение в этом случае, делиться ключами. Поддерживать эту процедуру между большим количеством людей, массово.

***— Еще возникает проблема синхронизации. В Jabber давно имелась возможность оконечного шифрования, но это вызывало некоторые проблемы: допустим, ты оффлайне мог пропустить и потерять сообщения. Помню, что много проблем с ним было.***

— Возвращаясь к Jabber, раз вспомнили. Он позиционировал себя как: есть основной документ, а есть расширения протокола. Это скатилось к множеству расширений, которые могли не поддерживаться клиентами. В Matrix принципиально хотят вести одну спеку, единый документ без расширений.

***— Они взяли новое шифрование или какое-то старое?***

— Они взяли принципы (про которые я сейчас не готов рассказать: double ratchet и т.п.) — сигналовские. Но имплементацию сделали свою, потому что нужно было сделать не просто общение один-к-одному, но еще и в группах.

Действительно, сложно сделать так, чтобы решением было удобно пользоваться. Например, довольно сложно решить задачи с хранением ключей, распространением, как не запутаться в них. Особенно, по части UI/UX.

***— То есть стандартные механизмы обмена ключами не сработают?***

— Сработают. Но практика покажет, как это лучше сделать.

## Новизна

Новизна, думаю, тоже понятна. Чем они принципиально отличаются от того же Сигнала: тем, что Matrix не становится очередным прикладным протоколом, а пытается создать инфраструктуру, которая будет связывать эти протоколы. Что-то типа e-mail, только для мгновенных сообщений, с сохранением переписок, с шифрованием, децентрализацией, интероперабельностью, для любых данных.

***— Мне интересен формат. Вот у нас децентрализация. Идет заведомо доверие к серверам или нет? Знает ли сам сервер, что на нем лежит?***

— Если мы не включили сквозное шифрование, то нам нужно доверять нашему узлу, который мы можем развернуть сами, потому что решение открытое. Если мы включаем сквозное шифрование, то серверам вообще не требуется доверять.

***[kitsune] Это не совсем так. Во-первых, метаданные в Matrix защищены только в плане целостности, но они не шифруются и видны всей федерации. Во-вторых, клиенты в очень большой степени вынуждены доверять своим серверам. Access token твой на сервере лежит; и даже без него сервер, вообще говоря, может создать от твоего имени новый девайс, сгенерировать ключи для него и пойти рассылать сообщения от твоего имени (хотя да, остальные должны будут верифицировать этот девайс). Зашифрованный контент твой сервер в любом случае не сможет расшифровать, но утверждение, что серверам не требуется доверять, предполагает нечто большее.***

Но это промежуточная итерация. Глобальная цель: заманить всех в peer-to-peer. Сначала ты научишь людей заводить серваки и пользоваться разными серверами, а не одним. Потом, связав сервера и клиенты в одну сущность на устройстве, когда оно будет способно это делать, мы получим peer-to-peer.

***[kitsune] Peer-to-peer — это хорошо, но ни разу не универсально. Обычно P2P приносит большую часть проблем :) Я тут тоже докладывался в субботу как раз, и мне там пришла в голову фраза про индивидуальных владельцев хоумсерверов: внезапно ты начинаешь поддерживать сервер в углу своей комнаты, который обслуживает весь интернет.***

***[kitsune] Некоторые проблемы старые и давно известные. Например, проблема "чужого трафика", массово идущего через твой узел, потому что он случайно оказался удобным перевалочным пунктом в текущей топологии. Многие пиринговые приложения — это полная труба для подключений с ограничением по трафику.***

***— Так как peer-to-peer, если сервер все равно есть?***

— Если ты свяжешь воедино сервер и клиент, серверов в привычном понимании уже не будет, это будет более сложное понятие.

Кстати, по поводу клиентов. Принципиальное отличие протокола от того же Signal, если я не ошибаюсь, что клиент — это устройство. Например, общаясь с кем-то и доверяя его домашнему компу, ты можешь увидеть, что появилось новое устройство. Например, с кафешки в Египте. Можно не доверять конкретному устройству, и тогда история не будет делиться с ним.

***— С одной стороны — это бонус, с другой — сложности. Нужно обеспечивать синхронизацию между устройствами, делиться ключами.***

— Да, по части UI рассматривают варианты, как обмениваться QR-кодами, эмоджи и т.п.

## Степень проработанности

![](https://i.imgur.com/oL9WEDO.png)

Текущее состояние. Как вы понимаете по кадру с бездомными из фильма, всё не очень хорошо... :)

***— Ну, ты лукавишь, конечно! :D***

— В целом, библиотека шифрования сделана, и это большое дело.

***— Есть много также реализаций узлов, которые связывают Matrix с другими сетями***

— [Мосты](https://matrix.org/bridges/)

***— Мосты! Их уже очень много: irc, xmpp, slack, telegram и много другого***

***— Обычно, как мне кажется, они являются узким местом в плане уязвимостей***

— Это, наверное, можно обсудить отдельно, не знаю, что ответить с ходу

В общем, уже есть спецификация на [клиент-сервер](https://matrix.org/docs/spec/client_server/latest) взаимодействие, [сервер-сервер](https://matrix.org/docs/spec/server_server/latest) взаимодействие. Есть текущая [реализация сервера на Python](https://github.com/matrix-org/synapse). Причем, она должна была быть референсной имплементацией, чтобы проверить, как все работает. А из-за популярности стала боевой, ей все пользуются.

***— Хах***

— Версия протокола 1.0 в целом вышла [в этом году](https://matrix.org/blog/2019/06/11/introducing-matrix-1-0-and-the-matrix-org-foundation). От питоновской версии есть планы перейти [на Go](https://github.com/matrix-org/dendrite). В том числе есть проект [на Rust](https://www.ruma.io/). Но на ранних стадиях развития. Сейчас все на питоне.

Проблемы с производительностью и масштабированием есть. Есть также клиентские [SDK для Android](https://github.com/matrix-org/matrix-android-sdk), [для iOS](https://github.com/matrix-org/matrix-ios-kit). Для Android недавно сделали клиент [RiotX на Kotlin](https://medium.com/@RiotChat/introducing-the-riotx-beta-for-android-b17952e8f771). Есть [SDK для Qt](https://github.com/quotient-im/), в который я контрибьютил. Есть [Rust](https://github.com/ruma/ruma-client), [JS](https://github.com/matrix-org/matrix-js-sdk). [В целом](https://matrix.org/docs/projects/sdks/), поскольку есть REST API с JSON можно хоть через curl оправлять сообщения — ничего не мешает.

***— Есть вопросец. До этого ты говорил, что Matrix — слой поверх IP-коммуникаций, а из того, что ты сейчас сказал, следует, что он чуть ли не поверх HTTP?***

— Сейчас транспорт HTTP взят за основу для того, чтобы быстрее расти. Но у меня есть запасной слайд, где показано, как делают [клёвые штуки](https://www.youtube.com/watch?v=DZBvy4abB1o) поверх UDP/CoAP/etc для встраиваемых решений по слабому каналу связи.

***— То есть текущее решение устроено так, но это не завязано в стандарте?***

— Похоже, да, но боюсь наврать, надо перепроверить [в стандарте](https://matrix.org/docs/spec/client_server/latest#api-standards).

***[kitsune] На самом деле сейчас завязано, см. напр. [spec](https://matrix.org/docs/spec/client_server/latest#api-standards), и вообще через весь стандарт хватает предположений о том, что вся эта штука работает через JSON over HTTP(S).***

***[kitsune] Утверждение, тем не менее, состоит в том, что, путем минимальных изменений в коде клиентов и серверов, можно поддержать другие протоколы. И ни JSON, ни HTTP, — не являются неотъемлемой частью, встроенной в Matrix. Он просто их использует, как субстрат. Ну, и пока не нашлось человека, которому бы реально нужно было сделать протоколы medium-agnostic. PoC по переносу на другую среду сделали, гипотезу доказали.***

***[kitsune] Приходили разные люди. Говорили, что, мол, COPR компактнее, мы неразумно тратим bandwidth. Что показал PoC, это что самый большой оверхед в плане размера пейлоада на самом деле - на TLS.***

***— Текущее решение — вообще Layer 7 какой-то? :D***

***[kitsune] Если что, Matrix использует инкапсуляцию на прикладном уровне. Формально все эти REST-вызовы, какую бы подложку они ни использовали, остаются на прикладном уровне. Модель OSI вообще не натягивается на иерархию, появившуюся поверх HTTP :( Сетевики, что с них возьмёшь.***

***[kitsune] Чисто теоретически, Matrix можно замутить на голом IP, написав собственный эквивалент какого-нибудь QUIC.
Так что можно сказать, что концептуально он действительно находится где-то между прикладным и транспортным уровнями.
Но "случайно" реализован в терминах чисто прикладного уровня на данный момент.***

***— Ладно, прикладной вопрос: в браузере работает или нет?***

— Да, [работает](http://riot.im/).

***— Отлично!***

— Лично мне, наоборот, хотелось бы не только браузер :D Поэтому я контрибьючу в [либу на Qt](https://github.com/quotient-im/).

## Апробация результатов, демонстрация

Попробую показать демонстрацию

***— Пока ты готовишься, скажу, что уже есть какие-то наработки для браузеров с QML вместо HTML/CSS/JS***

***— Хыхыхы***

— Это клево, но вроде такие и раньше были попытки, надо будет посмотреть отдельно.

***[kitsune] Первые действительно стоящие наработки для браузеров с QML называются [Qt for WebAssembly](https://doc.qt.io/qt-5/wasm.html), появились совсем недавно :) И это действительно ОЧЕНЬ интересно. Я вот всё никак не соберусь добраться попробовать. Размеры бинарников WebAssembly пока откровенно пугают :( Даром что Qt for WebAssembly на самом деле основную работу делает через emscripten, а это тот ещё монстрик.***

На главной странице проекта есть демка ["как работает Matrix"](https://matrix.org/).

***— Классно!***

***— Это что-то типа мультикаста?***

***— Не любил особо Matrix никогда, казалось, это сектанты, а тут стало интересно :D***

— Не знаю, как правильно сравнивать с мультикастом, не готов проводить аналогии

***[kitsune] Нету мультикаста в Матриксе, то есть совсем. Мультикаст никак не проецируется на E2EE, кстати :)***

***— А роутинг как работает?***

— Дальше на демке

***— О, это блокчейн? :D***

— Можно найти комментарии авторов насчет подобных аналогий, но я не смогу сейчас их вспомнить

***— Это не блокчейн, погоди! :D***

***[kitsune]  Каждая комната представляет собой так называемый направленный ацикличный граф Меркле, подклассом которого являются деревья Меркле, в простонародье именуемые блокчейном :)
Ещё один проект, который использует направленные ацикличные графы Меркле - это IPFS.
Etherium, Bitcoin и многие другие используют обычные деревья Меркле.***

— На демке показано, как решается синхронизация

***— А, то есть все получают сообщения, а отвечает только тот, кому оно надо?***

— Вся переписка синхронизируется между всеми серваками. Если ты вырубишь свой сервак, это ничего не порушит

***— Это нормально?***

***— Оно шифровано***

***— А, оно уже шифровано?***

— В зависимости от ситуации, которая тебе нужна на практике, ты можешь делать либо сквозное шифрование, либо доверять серваку.

***— А может быть такое, что ты просто потерял, забыл свой ключ на левом серваке, который может теперь расшифровать твое сообщение?***

***— Ты не хранишь приватный ключ на сервере***

***— Оконечное шифрование***

— Покажу также [веб-клиент](https://riot.im/), который сейчас, *к сожалению*, наиболее развит... :D

***— Это Riot?***

— Да, Riot. Поднят публичный сервер Matrix, который в будущем собираются закрыть, когда все начнут переходить на свои self-hosted сервера. Можем на нем посмотреть интерфейс Riot.

В списке все комнаты со всех серверов, но фильтры "communities" позволяют быстро находить нужные.

[В русскоязычной группе матрикс](https://matrix.to/#/#ru.matrix:matrix.org), например, я объявил о нашей встрече.

***— Это реакции там?***

— Да, есть реакции, есть replies. Можно даже виджеты встраивать в шапку сообщества с какой-нибудь, не знаю, температурой.

***— Чтобы своровать cookies! :D***

***— А JS в запросе можно отправлять? :D***

***— Такой вопрос: подразумевает ли этот протокол использовать какую-то конкретную модель сообщений? Он больше похож на Telegram с линейной полосой ответов или больше на Slack с ветками сообщений?***

— Не заставляется делать все клиенты одинаковыми. Давайте посмотрим [спеку](https://matrix.org/docs/spec/client_server/latest#rich-replies).

***— Мы спрашиваем, чтобы в чатах поддержки ответы человеку, задавшему вопрос, не преврашались в кашу***

— Можно делать треды, в спеке есть [пояснения](https://matrix.org/docs/spec/client_server/latest#forming-relationships-between-events) по этому поводу, надо [разбираться](https://github.com/vector-im/riot-web/issues/2349). Если что, перепроверьте меня.

***[kitsune] Треды — это больная тема, на самом деле. Сейчас более-менее специфицирован механизм ответов, но коммуникация и визуализация веток обсуждения сейчас в очень зачаточном состоянии. Но мы работаем над этим.
Ключевое предложение в спеку на этапе принятия — [MSC1849](https://github.com/matrix-org/matrix-doc/pull/1849/files)***

***— То есть это ЖЖ? :D***

***— Ты говорил, что все сервера реплицируют между собой все сообщения. Как это масштабируется? Особенно в условиях p2p...***

— Время покажет! :D

***[kitsune] Вот, вот это и есть одна из причин, по которой p2p — проблемное решение. На самом деле реплицируются не все сообщения, а только те, которые нужны серверу + всем его клиентам. Что нужно клиентам понятно, они гоняют синки и запрашивают историю (обычно весьма ограниченный кусок) сообщений. А вот серверам помимо этого нужно, чтобы любые действия, связанные с access control (power levels, joins/leaves, bans...), — были проверены против текущего состояния прав в комнат. И для этого они должны подтягивать к себе всю цепочку т.н. auth events, т.е. всё что относится к изменениям этих самых прав. И это, для крупных комнат типа Matrix HQ — до хрена :)***

***— То есть ты просто берешь всю мировую переписку к себе? Оно автоматически раскидывается всем?***

***— Ну, blockchain так работает...***

***— Blockchain? Двое суток ждать сообщения?***

— Насколько я понимаю, сейчас есть решения, в духе ["не шарить в определенных случаях что-то"](https://matrix.org/docs/spec/client_server/latest#server-access-control-lists-acls-for-rooms). А то, как это покажет себя в будущем, я не знаю.

***— То есть этот вопрос сейчас очень туманный?***

— Для меня туманный :)

***— Это глупость с точки зрения клиента! Я не буду пользоваться клиентом, где мне нужно галочками следить за всем этим***

— Тебе не нужно ставить галочки. Это на плечах админа, который держит твой узел.

***— Фишка в том, что ты можешь выбрать сервер, который годится тебе по условиям***

— Смотрите, ребята. Я сделал группу [2600 на русском](https://matrix.to/#/#ru2600:matrix.org). Можно сделать мост до телеги и заманивать сюда людей. О, уже два человека!

***— Капец он медленный, если честно***

— Он медленный да, нужно хостить свой сервак и контрибьютить кодом.

***[kitsune] Медленный он в основном потому, что граф пользователей жутко разбалансирован. Куча людей сидит на одном бедном [matrix.org](https://matrix.org/) вместо того, чтобы быть разложенной по отдельным серверам. Где каждый занимается более-менее своими комнатами, и лишь часть коммуникации действительно летает через всю федерацию.
Но тут уж что имеем, цена взрывного роста.***

***— Скажи мне, какая принципиальная разница между Matrix и Jabber?***

— Jabber не фокусируется на том, чтобы шарить историю, он просто про обмен сообщениями. И Jabber в протоколе минималистичен, а остальное делается расширениями. Здесь документ один.

***— Не понял***

— Лучше попробуй сам поковырять изнутри

***— Фундаментальная проблема ICQ решена? Я файл могу отправить другому человеку? В гигабайт? Он будет шариться на всех серваках?***

— Насколько я понимаю, для файлов в спеке отдельные комментарии, и надо [почитать](https://matrix.org/docs/spec/client_server/latest#m-room-message-msgtypes), как обходятся с ними.

***[kitsune] С файлами всё очень просто, файл отправляется на один ("свой") сервер, и оттуда доступен всем остальным.
Т.е. этот гигабайт через федерацию не летает, конечно.
(Т.е. летает, но только для желающих его скачать — что на самом деле ещё больший недостаток для раздачи больших файлов. В общем, Matrix — пока не замена торрентов для этой цели).***

***— Ждем, когда подешевеет память, и вырастут каналы :D***

— Кстати, вспомнил! Есть отдельная [issue насчет IPFS](https://github.com/matrix-org/matrix-doc/issues/539).

Попробуем лучше подключить группу [хакспейса b3cksp4c3](https://matrix.to/#/#b4ck5p4c3:matrix.org) из телеги позже.

## Моё участие этим летом: GSoC 2019

Вернемся к докладу. Я участвовал в [Google Summer of Code](https://summerofcode.withgoogle.com/archive/2019/organizations/4888795948777472/). Контрибьютил в [либу на Qt](https://github.com/quotient-im/libQuotient). Есть библиотека, на основе которой развиваются несколько Qt-клиентов: [Quaternion](https://github.com/quotient-im/Quaternion) и [Spectral](https://gitlab.com/b0/spectral). В ней пока нету поддержки сквозного шифрования. За лето мне удалось впилить простой прием сообщений, надо доделывать и отправку, и остальное.

Для шифрования я брал готовую библиотеку, для которой сделали Qt-обертку.

***— Надо быть аккуратным, используя готовые библиотеки, особенно по шифрованию. Например, следить за солью.***

— Я брал ту общую либу, которая лежит [в репе сообщества](https://gitlab.matrix.org/matrix-org/olm/). Они, кстати, не шарят ее на гитхабе, а на своем европейском гитлаб-серваке, чтобы не договариваться с гитхабом документами.

***— Глупый вопрос: а шифрование симметричное или ассиметричное?***

— Насколько я понимаю, смотря для чего, нужно разбирать отдельно.

***[kitsune]: есть простой ответ: и то, и другое :))
Для разных вещей разное.
Сообщения шифруются асимметричным протоколом, например, файлы - симметричным.***

## Заключение, текущие задачи

Текущие планы организации Matrix. Они были объявлены в феврале, я мог упустить, что какие-то задачи уже выполнены. Каноничная личка, переработка сообществ, возможность переезда между серверами, развите сервера на go. И планы про работу с метаданными и peer-to-peer.

***— Похоже, принципы работы с метаданными аналогичны тем, что сейчас у blockchain, когда тоже нужно заботиться об анонимности и безопасности дополнительно***

— Покажу вам также быстро отрывки [FOSDEM-выступлений](https://archive.fosdem.org/2019/schedule/speaker/matthew_hodgson/) от про 100 bit/sec для low-end devices, про VR демку.

***— Надо посмотреть подробнее***

— Также могу попробовать рассказать что нашел про финансирование.

***— Опа***

— Это не инсайд, [доступная информация](https://www.reddit.com/r/privacy/comments/da219t/im_project_lead_for_matrixorg_the_open_protocol/f1nwlra/). Сначала в них вкладывалась телеком-компания, потом отпустила в свободное плавание. Была запущена коммерческая организация, чтобы формировать ресурсы. Также нашелся [гос. подряд во Франции](https://matrix.org/blog/2018/04/26/matrix-and-riot-confirmed-as-the-basis-for-frances-secure-instant-messenger-app), где подобная структура нужна для коммуникаций множества различных ведомств. После, похоже, нашли [еще средства](https://matrix.org/blog/2019/10/10/new-vector-raises-8-5-m-to-accelerate-matrix-riot-modular).

Интересно, как для [проекта во Франции](https://www.youtube.com/watch?v=C2eE7rCUKlE) им, с одной стороны, нужно было сквозное шифрование, с другой — антивирусная проверка. И они это интересно решили, проверяя до отправки на стороне клиента файл сторонней службой и после приема такой же, интегрировав ее в систему.

Еще весной был [взлом внутренней инфраструктуры](https://matrix.org/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident) сообщества, выложены при этом issues на их гитхабе :D После этого был представлен подробный отчет, что происходило и как предотвратить подобные вещи в будущем.

***— Вопрос: кому принадлежит наибольшее количество серверов? Возможна ли ситуация, которую приписывают Tor, когда большая часть узлов, возможно, подконтрольна NSA?***

— Безопасноть — вопрос доверия. Доверяешь серваку — пользуйся. Другим серверам доверять не требуется.

***— Надо разбираться и пробовать хостить свои решения***

— Спасибо!

***— [хлопочки]***

## Вопросы

![](https://i.imgur.com/5RHgYNi.png)

**P.S.: вопросы после выступления**


***— Мне их [консольный клиент](https://github.com/tulir/gomuks) милей. В моем воркфлоу куча консолей, хоткеев, тайлинг так что мне самое удобное :)***

***— А сколько времени ты тратишь на разработку Qt-клиента?***

— Летом все свободное время с перерывами, сейчас почти совсем не успеваю, но планирую вернуться в строй.

***— А что про центры идентификации?***

— Про них надо отдельно разбираться, не смогу рассказать

***— Круто, как авторы вовремя с такой идеей подоспели***

— Я думаю, идея висит в воздухе. Вопрос в том, где найти средств, и как ее правильно осуществить.

![](https://i.imgur.com/owDnbqG.png)


*Слайды презентации:*
+ [gdrive: на русском](https://docs.google.com/presentation/d/1HEYBmolqHVAg6xg7nPcrFwxvyGZ7scwpYpti75pMDok/edit?usp=sharing)
+ [gdrive: на английском](https://docs.google.com/presentation/d/1VTg13hHCAa1pdFHVh8A_-rtY3qfYTkI_yqaJM-jZwek/edit?usp=sharing)

*Спасибо большое zafod и Kaffeine за вычитку и поддержку, а kitsune еще и за ценные комментарии! Схемы на слайдах были утащены из [оригинальных](https://archive.fosdem.org/2016/schedule/event/matrix/) слайдов [ara4n](https://matrix.to/#/@matthew:matrix.org), спасибо ему за них и за [matrix](https://www.youtube.com/watch?v=eA0KnTt4O7E) :)*

*Я приехал на митап, чтобы выступить и выпить. Как видишь, я уже выступил.*
